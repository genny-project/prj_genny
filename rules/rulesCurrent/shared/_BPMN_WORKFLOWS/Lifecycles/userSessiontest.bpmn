<?xml version="1.0" encoding="UTF-8"?>
<!-- origin at X=0.0 Y=0.0 -->
<bpmn2:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:drools="http://www.jboss.org/drools" xmlns="http://www.jboss.org/drools" xmlns:java="http://www.java.com/javaTypes" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd http://www.jboss.org/drools drools.xsd http://www.bpsim.org/schemas/1.0 bpsim.xsd" exporter="org.eclipse.bpmn2.modeler.core" exporterVersion="1.5.1.Final-v20190425-2005-B1" expressionLanguage="http://www.mvel.org/2.0" targetNamespace="http://www.jboss.org/drools" typeLanguage="http://www.java.com/javaTypes">
  <bpmn2:itemDefinition id="ItemDefinition_92" isCollection="false" structureRef="life.genny.utils.SessionFacts"/>
  <bpmn2:itemDefinition id="ItemDefinition_94" isCollection="false" structureRef="life.genny.utils.OutputParam"/>
  <bpmn2:itemDefinition id="ItemDefinition_96" isCollection="false" structureRef="life.genny.models.GennyToken"/>
  <bpmn2:itemDefinition id="ItemDefinition_1938" isCollection="false" structureRef="life.genny.qwanda.message.QEventMessage"/>
  <bpmn2:itemDefinition id="ItemDefinition_1940" isCollection="false" structureRef="life.genny.qwanda.message.QDataMessage"/>
  <bpmn2:itemDefinition id="ItemDefinition_2719" isCollection="false" structureRef="java.lang.String"/>
  <bpmn2:itemDefinition id="ItemDefinition_3028" isCollection="false" structureRef="life.genny.qwanda.message.QCmdMessage"/>
  <bpmn2:itemDefinition id="ItemDefinition_3031" isCollection="false" structureRef="life.genny.utils.VertxUtils.ESubscriptionType"/>
  <bpmn2:itemDefinition id="ItemDefinition_3032" isCollection="false" structureRef="life.genny.utils.VertxUtils"/>
  <bpmn2:itemDefinition id="ItemDefinition_446" isCollection="false" structureRef="life.genny.qwanda.entity.BaseEntity"/>
  <bpmn2:itemDefinition id="ItemDefinition_475" isCollection="false" structureRef="life.genny.utils.BaseEntityUtils"/>
  <bpmn2:itemDefinition id="ItemDefinition_1071" isCollection="false" structureRef="life.genny.qwandautils.JsonUtils"/>
  <bpmn2:signal id="Signal_1" name="newSession"/>
  <bpmn2:signal id="Signal_2" name="DISPLAY"/>
  <bpmn2:process id="userSessiontest" drools:version="1" drools:packageName="defaultPackage" drools:adHoc="false" name="Default Process" isExecutable="true">
    <bpmn2:extensionElements>
      <drools:import name="life.genny.utils.SessionFacts"/>
      <drools:import name="life.genny.utils.OutputParam"/>
      <drools:import name="life.genny.models.GennyToken"/>
      <drools:import name="life.genny.qwanda.message.QEventMessage"/>
      <drools:import name="life.genny.qwanda.message.QDataMessage"/>
      <drools:import name="life.genny.qwanda.message.QCmdMessage"/>
      <drools:import name="life.genny.utils.VertxUtils"/>
      <drools:import name="life.genny.utils.VertxUtils.ESubscriptionType"/>
      <drools:import name="life.genny.qwanda.entity.BaseEntity"/>
      <drools:import name="life.genny.utils.BaseEntityUtils"/>
      <drools:import name="life.genny.qwandautils.JsonUtils"/>
    </bpmn2:extensionElements>
    <bpmn2:property id="output" itemSubjectRef="ItemDefinition_94" name="output"/>
    <bpmn2:property id="userToken" itemSubjectRef="ItemDefinition_96" name="userToken"/>
    <bpmn2:property id="serviceToken" itemSubjectRef="ItemDefinition_96" name="serviceToken"/>
    <bpmn2:property id="sessionFacts" itemSubjectRef="ItemDefinition_92" name="sessionFacts"/>
    <bpmn2:property id="message" itemSubjectRef="ItemDefinition_1938" name="message"/>
    <bpmn2:property id="dataMessage" itemSubjectRef="ItemDefinition_1940" name="dataMessage"/>
    <bpmn2:property id="session_state" itemSubjectRef="ItemDefinition_2719" name="session_state"/>
    <bpmn2:property id="sessionCode" itemSubjectRef="ItemDefinition_2719" name="sessionCode"/>
    <bpmn2:property id="currentUser" itemSubjectRef="ItemDefinition_446" name="currentUser"/>
    <bpmn2:startEvent id="StartEvent_1" name="Start Event 1">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[Start Event 1]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:outgoing>SequenceFlow_2</bpmn2:outgoing>
      <bpmn2:dataOutput id="DataOutput_2" name="event"/>
      <bpmn2:dataOutputAssociation id="DataOutputAssociation_1">
        <bpmn2:sourceRef>DataOutput_2</bpmn2:sourceRef>
        <bpmn2:targetRef>sessionFacts</bpmn2:targetRef>
      </bpmn2:dataOutputAssociation>
      <bpmn2:outputSet id="OutputSet_1" name="Output Set 1">
        <bpmn2:dataOutputRefs>DataOutput_2</bpmn2:dataOutputRefs>
      </bpmn2:outputSet>
      <bpmn2:signalEventDefinition id="SignalEventDefinition_1" signalRef="userSession.bpmn#Signal_9"/>
    </bpmn2:startEvent>
    <bpmn2:endEvent id="EndEvent_1" name="End userSession">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[End userSession]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>SequenceFlow_9</bpmn2:incoming>
    </bpmn2:endEvent>
    <bpmn2:scriptTask id="ScriptTask_1" name="Initialise" scriptFormat="http://www.java.com/java">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[Initialise]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>SequenceFlow_2</bpmn2:incoming>
      <bpmn2:outgoing>SequenceFlow_3</bpmn2:outgoing>
      <bpmn2:script>System.out.println(&quot;userSession: initialise: initial Task - UserSessionDetails&quot;);
message = (QEventMessage)((SessionFacts)sessionFacts).getMessage();
serviceToken = (GennyToken)((SessionFacts)sessionFacts).getServiceToken();
userToken = (GennyToken)((SessionFacts)sessionFacts).getUserToken();
System.out.println(&quot;userSession:  initialise: processId = &quot;+kcontext.getProcessInstance().getId());
System.out.println(&quot;userSession:  initialise: Entering userSession &quot;+((QEventMessage)message).getData().getCode()+&quot; with (userToken)userCode = &quot;+((GennyToken)userToken).getUserCode());

((QEventMessage)message).getData().setValue(&quot;NEW_SESSION&quot;);   
kcontext.setVariable(&quot;message&quot;,(QEventMessage)message); 
kcontext.setVariable(&quot;session_state&quot;,((GennyToken)userToken).getSessionCode()); 
kcontext.setVariable(&quot;serviceToken&quot;,((GennyToken)serviceToken)); 
kcontext.setVariable(&quot;userToken&quot;,userToken); 

sessionCode = userToken.getSessionCode();
kcontext.setVariable(&quot;sessionCode&quot;, sessionCode);
System.out.println(&quot;userSession:  initialise: Session Code = &quot;+ sessionCode);


output = new OutputParam();
output.setFormCode(&quot;FRM_APP&quot;,&quot;FRM_ROOT&quot;); 

kcontext.setVariable(&quot;output&quot;,output);</bpmn2:script>
    </bpmn2:scriptTask>
    <bpmn2:sequenceFlow id="SequenceFlow_2" drools:priority="1" sourceRef="StartEvent_1" targetRef="ScriptTask_1"/>
    <bpmn2:scriptTask id="ScriptTask_2" name="Show sessionCode" scriptFormat="http://www.java.com/java">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[Show sessionCode]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>SequenceFlow_3</bpmn2:incoming>
      <bpmn2:outgoing>SequenceFlow_5</bpmn2:outgoing>
      <bpmn2:script>System.out.println(&quot;userSession: 'Show SessionCode' sessionCode = &quot;+session_state);</bpmn2:script>
    </bpmn2:scriptTask>
    <bpmn2:sequenceFlow id="SequenceFlow_3" drools:priority="1" sourceRef="ScriptTask_1" targetRef="ScriptTask_2"/>
    <bpmn2:intermediateCatchEvent id="IntermediateCatchEvent_1" name="Session Timeout">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[Session Timeout]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>SequenceFlow_6</bpmn2:incoming>
      <bpmn2:outgoing>SequenceFlow_7</bpmn2:outgoing>
      <bpmn2:timerEventDefinition id="TimerEventDefinition_1">
        <bpmn2:timeDuration xsi:type="bpmn2:tFormalExpression" id="FormalExpression_1">PT2M</bpmn2:timeDuration>
      </bpmn2:timerEventDefinition>
    </bpmn2:intermediateCatchEvent>
    <bpmn2:exclusiveGateway id="ExclusiveGateway_3" name="Route" gatewayDirection="Diverging" default="SequenceFlow_14">
      <bpmn2:incoming>SequenceFlow_10</bpmn2:incoming>
      <bpmn2:outgoing>SequenceFlow_6</bpmn2:outgoing>
      <bpmn2:outgoing>SequenceFlow_14</bpmn2:outgoing>
    </bpmn2:exclusiveGateway>
    <bpmn2:sequenceFlow id="SequenceFlow_6" drools:priority="1" name="No Logout" sourceRef="ExclusiveGateway_3" targetRef="IntermediateCatchEvent_1">
      <bpmn2:conditionExpression xsi:type="bpmn2:tFormalExpression" id="FormalExpression_4" language="http://www.java.com/java">return (!output.getTypeOfResult().equals(&quot;LOGOUT&quot;));</bpmn2:conditionExpression>
    </bpmn2:sequenceFlow>
    <bpmn2:scriptTask id="ScriptTask_7" name="Log Out" scriptFormat="http://www.java.com/java">
      <bpmn2:documentation id="Documentation_28"><![CDATA[Logging Out]]></bpmn2:documentation>
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[Log Out]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>SequenceFlow_13</bpmn2:incoming>
      <bpmn2:outgoing>SequenceFlow_8</bpmn2:outgoing>
      <bpmn2:script>System.out.println(&quot;userSession: 'Log Out' LOGOUT Detected&quot;);
QCmdMessage msgLogout = new QCmdMessage(&quot;LOGOUT&quot;, &quot;LOGOUT&quot;);
msgLogout.setToken(userToken.getToken());
VertxUtils.writeMsg(&quot;webcmds&quot;,JsonUtils.toJson(msgLogout));
System.out.println(&quot;userSession: 'Log out' Deleting userSession &quot;+userToken.getSessionCode()+&quot; from processId map&quot;);
VertxUtils.writeCachedJson(userToken.getRealm(),userToken.getSessionCode(),null,userToken.getToken());
currentUser = VertxUtils.getObject(serviceToken.getRealm(), &quot;&quot;, userToken.getUserCode(),BaseEntity.class, serviceToken.getToken());
System.out.println(&quot;userSession: 'Log out' Exiting userSession for &quot;+currentUser.getCode());
</bpmn2:script>
    </bpmn2:scriptTask>
    <bpmn2:scriptTask id="ScriptTask_8" name="Timeout" scriptFormat="http://www.java.com/java">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[Timeout]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>SequenceFlow_7</bpmn2:incoming>
      <bpmn2:outgoing>SequenceFlow_12</bpmn2:outgoing>
      <bpmn2:script>System.out.println(&quot;userSession: 'Timeout' session Timeout event&quot;);</bpmn2:script>
    </bpmn2:scriptTask>
    <bpmn2:sequenceFlow id="SequenceFlow_7" drools:priority="1" sourceRef="IntermediateCatchEvent_1" targetRef="ScriptTask_8"/>
    <bpmn2:scriptTask id="ScriptTask_9" name="Exit Session">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[Exit Session]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>SequenceFlow_8</bpmn2:incoming>
      <bpmn2:outgoing>SequenceFlow_9</bpmn2:outgoing>
      <bpmn2:script>System.out.println(&quot;userSession: 'Exit Session' Aggregate SearchBar terms into userAccount&quot;);
System.out.println(&quot;userSession: 'Exit Session' Aggregate Session Times terms into userAccount History&quot;);
System.out.println(&quot;userSession: **************************End Session ****************************&quot;);</bpmn2:script>
    </bpmn2:scriptTask>
    <bpmn2:sequenceFlow id="SequenceFlow_8" drools:priority="1" sourceRef="ScriptTask_7" targetRef="ScriptTask_9"/>
    <bpmn2:sequenceFlow id="SequenceFlow_9" drools:priority="1" sourceRef="ScriptTask_9" targetRef="EndEvent_1"/>
    <bpmn2:exclusiveGateway id="ExclusiveGateway_4" gatewayDirection="Converging">
      <bpmn2:incoming>SequenceFlow_12</bpmn2:incoming>
      <bpmn2:incoming>SequenceFlow_14</bpmn2:incoming>
      <bpmn2:outgoing>SequenceFlow_13</bpmn2:outgoing>
    </bpmn2:exclusiveGateway>
    <bpmn2:sequenceFlow id="SequenceFlow_12" drools:priority="1" sourceRef="ScriptTask_8" targetRef="ExclusiveGateway_4"/>
    <bpmn2:sequenceFlow id="SequenceFlow_13" drools:priority="1" sourceRef="ExclusiveGateway_4" targetRef="ScriptTask_7"/>
    <bpmn2:sequenceFlow id="SequenceFlow_14" drools:priority="1" name="LOGOUT" sourceRef="ExclusiveGateway_3" targetRef="ExclusiveGateway_4"/>
    <bpmn2:subProcess id="SubProcess_1" name="Show Page Handler" triggeredByEvent="true">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[Show Page Handler]]></drools:metaValue>
        </drools:metaData>
        <drools:onEntry-script scriptFormat="http://www.java.com/java">
          <drools:script>System.out.println(&quot;userSession: 'Show Page Handler' processId = &quot;+kcontext.getProcessInstance().getId());</drools:script>
        </drools:onEntry-script>
      </bpmn2:extensionElements>
      <bpmn2:startEvent id="StartEvent_2" name="Start Display" isInterrupting="false">
        <bpmn2:extensionElements>
          <drools:metaData name="elementname">
            <drools:metaValue><![CDATA[Start Display]]></drools:metaValue>
          </drools:metaData>
        </bpmn2:extensionElements>
        <bpmn2:outgoing>SequenceFlow_18</bpmn2:outgoing>
        <bpmn2:dataOutput id="DataOutput_3" name="Signal_4_Output"/>
        <bpmn2:dataOutputAssociation id="DataOutputAssociation_2">
          <bpmn2:sourceRef>DataOutput_3</bpmn2:sourceRef>
          <bpmn2:targetRef>output</bpmn2:targetRef>
        </bpmn2:dataOutputAssociation>
        <bpmn2:outputSet id="OutputSet_3" name="Output Set 3">
          <bpmn2:dataOutputRefs>DataOutput_3</bpmn2:dataOutputRefs>
        </bpmn2:outputSet>
        <bpmn2:signalEventDefinition id="SignalEventDefinition_4" signalRef="Signal_2"/>
      </bpmn2:startEvent>
      <bpmn2:callActivity id="CallActivity_1" drools:waitForCompletion="true" drools:independent="false" name="Auth Init" calledElement="auth_init">
        <bpmn2:extensionElements>
          <drools:metaData name="elementname">
            <drools:metaValue><![CDATA[Auth Init]]></drools:metaValue>
          </drools:metaData>
          <drools:onEntry-script scriptFormat="http://www.java.com/java">
            <drools:script>System.out.println(&quot;userSession: 'authinit' Entering auth_init with output = &quot;+output);
System.out.println(&quot;\n***************  Exiting userSession - Entering auth_init  ***************&quot;);
</drools:script>
          </drools:onEntry-script>
          <drools:onExit-script scriptFormat="http://www.java.com/java">
            <drools:script>System.out.println(&quot;\n***************  Exiting auth_init - Entering userSession  ***************&quot;);

System.out.println(&quot;userSession: Exiting auth_init with output = &quot;+output);
if (output.getTypeOfResult().equals(&quot;ERROR&quot;)) {
	System.out.println(&quot;userSession: Forcing session to logout&quot;);
		output.setResultCode(&quot;USER_LOGOUT&quot;);
		output.setTypeOfResult(&quot;LOGOUT&quot;);
}</drools:script>
          </drools:onExit-script>
        </bpmn2:extensionElements>
        <bpmn2:incoming>SequenceFlow_18</bpmn2:incoming>
        <bpmn2:outgoing>SequenceFlow_17</bpmn2:outgoing>
        <bpmn2:ioSpecification id="InputOutputSpecification_2">
          <bpmn2:dataInput id="DataInput_6" itemSubjectRef="ItemDefinition_94" name="output"/>
          <bpmn2:dataInput id="DataInput_7" itemSubjectRef="userSession.bpmn#ItemDefinition_174" name="userToken"/>
          <bpmn2:inputSet id="InputSet_2" name="Input Set 3">
            <bpmn2:dataInputRefs>DataInput_6</bpmn2:dataInputRefs>
            <bpmn2:dataInputRefs>DataInput_7</bpmn2:dataInputRefs>
          </bpmn2:inputSet>
          <bpmn2:outputSet id="OutputSet_4" name="Output Set 4"/>
        </bpmn2:ioSpecification>
        <bpmn2:dataInputAssociation id="DataInputAssociation_3">
          <bpmn2:sourceRef>output</bpmn2:sourceRef>
          <bpmn2:targetRef>DataInput_6</bpmn2:targetRef>
        </bpmn2:dataInputAssociation>
        <bpmn2:dataInputAssociation id="DataInputAssociation_4">
          <bpmn2:sourceRef>userToken</bpmn2:sourceRef>
          <bpmn2:targetRef>DataInput_7</bpmn2:targetRef>
        </bpmn2:dataInputAssociation>
      </bpmn2:callActivity>
      <bpmn2:scriptTask id="ScriptTask_10" name="Mid-Sess Task" scriptFormat="http://www.java.com/java">
        <bpmn2:extensionElements>
          <drools:metaData name="elementname">
            <drools:metaValue><![CDATA[Mid-Sess Task]]></drools:metaValue>
          </drools:metaData>
        </bpmn2:extensionElements>
        <bpmn2:incoming>SequenceFlow_17</bpmn2:incoming>
        <bpmn2:outgoing>SequenceFlow_19</bpmn2:outgoing>
        <bpmn2:script>System.out.println(&quot;userSession: Show Page Handler - NidSession Task&quot;);
System.out.println(&quot;userSession: Show Page Handler -  output = &quot; +output.getTypeOfResult());
</bpmn2:script>
      </bpmn2:scriptTask>
      <bpmn2:sequenceFlow id="SequenceFlow_17" drools:priority="1" sourceRef="CallActivity_1" targetRef="ScriptTask_10"/>
      <bpmn2:sequenceFlow id="SequenceFlow_18" drools:priority="1" sourceRef="StartEvent_2" targetRef="CallActivity_1"/>
      <bpmn2:task id="Task_2" drools:taskName="ShowFrame" drools:displayName="ShowFrame" drools:icon="icons/icon-info.gif" name="ShowFrame">
        <bpmn2:extensionElements>
          <drools:metaData name="elementname">
            <drools:metaValue><![CDATA[ShowFrame]]></drools:metaValue>
          </drools:metaData>
          <drools:onEntry-script scriptFormat="http://www.java.com/java">
            <drools:script>System.out.println(&quot;userSession: ShowFrame -> Rules finished with userToken = &quot;+userToken.getSessionCode()+&quot; and key = &quot;+userToken.getSessionCode()+&quot;:page&quot;);
System.out.println(&quot;userSession: ShowFrame -> Root Frame Code is &quot;+ output.getResultCode());
System.out.println(&quot;userSession: ShowFrame -> Target Frame Code is &quot; +output.getTargetCode());


</drools:script>
          </drools:onEntry-script>
          <drools:onExit-script scriptFormat="http://www.java.com/java">
            <drools:script>System.out.println(&quot;userSession: ShowFrame -> Root Frame Code is &quot;+ output.getResultCode());
System.out.println(&quot;userSession: ShowFrame -> Target Frame Code is &quot; +output.getTargetCode());</drools:script>
          </drools:onExit-script>
        </bpmn2:extensionElements>
        <bpmn2:incoming>SequenceFlow_19</bpmn2:incoming>
        <bpmn2:outgoing>SequenceFlow_20</bpmn2:outgoing>
        <bpmn2:ioSpecification id="InputOutputSpecification_3">
          <bpmn2:dataInput id="DataInput_8" itemSubjectRef="userSession.bpmn#ItemDefinition_10" name="rootFrameCode"/>
          <bpmn2:dataInput id="DataInput_9" itemSubjectRef="userSession.bpmn#ItemDefinition_174" name="userToken"/>
          <bpmn2:dataInput id="DataInput_10" itemSubjectRef="userSession.bpmn#ItemDefinition_10" name="targetFrameCode"/>
          <bpmn2:inputSet id="InputSet_3">
            <bpmn2:dataInputRefs>DataInput_8</bpmn2:dataInputRefs>
            <bpmn2:dataInputRefs>DataInput_9</bpmn2:dataInputRefs>
            <bpmn2:dataInputRefs>DataInput_10</bpmn2:dataInputRefs>
          </bpmn2:inputSet>
          <bpmn2:outputSet id="OutputSet_5" name="Output Set 9"/>
        </bpmn2:ioSpecification>
        <bpmn2:dataInputAssociation id="DataInputAssociation_5">
          <bpmn2:targetRef>DataInput_8</bpmn2:targetRef>
          <bpmn2:assignment id="Assignment_2">
            <bpmn2:from xsi:type="bpmn2:tFormalExpression" id="FormalExpression_8">#{output.getResultCode()}</bpmn2:from>
            <bpmn2:to xsi:type="bpmn2:tFormalExpression" id="FormalExpression_9">DataInput_13</bpmn2:to>
          </bpmn2:assignment>
        </bpmn2:dataInputAssociation>
        <bpmn2:dataInputAssociation id="DataInputAssociation_6">
          <bpmn2:sourceRef>userToken</bpmn2:sourceRef>
          <bpmn2:targetRef>DataInput_9</bpmn2:targetRef>
        </bpmn2:dataInputAssociation>
        <bpmn2:dataInputAssociation id="DataInputAssociation_7">
          <bpmn2:targetRef>DataInput_10</bpmn2:targetRef>
          <bpmn2:assignment id="Assignment_3">
            <bpmn2:from xsi:type="bpmn2:tFormalExpression" id="FormalExpression_10">#{output.getTargetCode()}</bpmn2:from>
            <bpmn2:to xsi:type="bpmn2:tFormalExpression" id="FormalExpression_11">DataInput_15</bpmn2:to>
          </bpmn2:assignment>
        </bpmn2:dataInputAssociation>
      </bpmn2:task>
      <bpmn2:sequenceFlow id="SequenceFlow_19" drools:priority="1" sourceRef="ScriptTask_10" targetRef="Task_2"/>
      <bpmn2:endEvent id="EndEvent_3" name="End Show Page Handler">
        <bpmn2:extensionElements>
          <drools:metaData name="elementname">
            <drools:metaValue><![CDATA[End Show Page Handler]]></drools:metaValue>
          </drools:metaData>
        </bpmn2:extensionElements>
        <bpmn2:incoming>SequenceFlow_20</bpmn2:incoming>
      </bpmn2:endEvent>
      <bpmn2:sequenceFlow id="SequenceFlow_20" drools:priority="1" sourceRef="Task_2" targetRef="EndEvent_3"/>
    </bpmn2:subProcess>
    <bpmn2:task id="Task_4" drools:taskName="SendSignal" drools:displayName="SendSignal" drools:icon="icons/icon-info.gif" name="SendSignal">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[SendSignal]]></drools:metaValue>
        </drools:metaData>
        <drools:metaData name="customAsync">
          <drools:metaValue><![CDATA[true]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>SequenceFlow_5</bpmn2:incoming>
      <bpmn2:outgoing>SequenceFlow_10</bpmn2:outgoing>
      <bpmn2:ioSpecification id="InputOutputSpecification_5">
        <bpmn2:dataInput id="DataInput_14" itemSubjectRef="ItemDefinition_96" name="userToken"/>
        <bpmn2:dataInput id="DataInput_15" name="signalCode"/>
        <bpmn2:dataInput id="DataInput_16" itemSubjectRef="ItemDefinition_94" name="payloadObject"/>
        <bpmn2:inputSet id="_InputSet_10">
          <bpmn2:dataInputRefs>DataInput_14</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>DataInput_15</bpmn2:dataInputRefs>
          <bpmn2:dataInputRefs>DataInput_16</bpmn2:dataInputRefs>
        </bpmn2:inputSet>
        <bpmn2:outputSet id="OutputSet_7" name="Output Set 7"/>
      </bpmn2:ioSpecification>
      <bpmn2:dataInputAssociation id="_DataInputAssociation_27">
        <bpmn2:sourceRef>userToken</bpmn2:sourceRef>
        <bpmn2:targetRef>DataInput_14</bpmn2:targetRef>
      </bpmn2:dataInputAssociation>
      <bpmn2:dataInputAssociation id="_DataInputAssociation_28">
        <bpmn2:targetRef>DataInput_15</bpmn2:targetRef>
        <bpmn2:assignment id="Assignment_7">
          <bpmn2:from xsi:type="bpmn2:tFormalExpression" id="FormalExpression_20">&quot;DISPLAY&quot;</bpmn2:from>
          <bpmn2:to xsi:type="bpmn2:tFormalExpression" id="FormalExpression_18">DataInput_15</bpmn2:to>
        </bpmn2:assignment>
      </bpmn2:dataInputAssociation>
      <bpmn2:dataInputAssociation id="_DataInputAssociation_29">
        <bpmn2:sourceRef>output</bpmn2:sourceRef>
        <bpmn2:targetRef>DataInput_16</bpmn2:targetRef>
      </bpmn2:dataInputAssociation>
    </bpmn2:task>
    <bpmn2:sequenceFlow id="SequenceFlow_5" drools:priority="1" sourceRef="ScriptTask_2" targetRef="Task_4"/>
    <bpmn2:sequenceFlow id="SequenceFlow_10" drools:priority="1" sourceRef="Task_4" targetRef="ExclusiveGateway_3"/>
  </bpmn2:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1" name="Default Process Diagram">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="userSessiontest">
      <bpmndi:BPMNShape id="BPMNShape_SubProcess_1" bpmnElement="SubProcess_1" isExpanded="true">
        <dc:Bounds height="187.0" width="660.0" x="560.0" y="420.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_1">
          <dc:Bounds height="11.0" width="81.0" x="566.0" y="423.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1" bpmnElement="StartEvent_1">
        <dc:Bounds height="36.0" width="36.0" x="100.0" y="100.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_2">
          <dc:Bounds height="11.0" width="53.0" x="92.0" y="136.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_2" bpmnElement="EndEvent_1">
        <dc:Bounds height="36.0" width="36.0" x="370.0" y="496.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_3">
          <dc:Bounds height="11.0" width="69.0" x="354.0" y="532.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ScriptTask_1" bpmnElement="ScriptTask_1" isExpanded="true">
        <dc:Bounds height="50.0" width="110.0" x="245.0" y="95.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_4">
          <dc:Bounds height="11.0" width="33.0" x="283.0" y="114.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ScriptTask_2" bpmnElement="ScriptTask_2" isExpanded="true">
        <dc:Bounds height="50.0" width="110.0" x="440.0" y="95.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_5">
          <dc:Bounds height="11.0" width="78.0" x="456.0" y="114.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_IntermediateCatchEvent_1" bpmnElement="IntermediateCatchEvent_1">
        <dc:Bounds height="36.0" width="36.0" x="378.0" y="410.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_6">
          <dc:Bounds height="11.0" width="67.0" x="363.0" y="446.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ExclusiveGateway_3" bpmnElement="ExclusiveGateway_3" isMarkerVisible="true">
        <dc:Bounds height="50.0" width="50.0" x="371.0" y="211.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_7">
          <dc:Bounds height="11.0" width="25.0" x="383.0" y="261.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ScriptTask_7" bpmnElement="ScriptTask_7" isExpanded="true">
        <dc:Bounds height="50.0" width="110.0" x="97.0" y="489.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_8">
          <dc:Bounds height="11.0" width="33.0" x="135.0" y="508.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ScriptTask_8" bpmnElement="ScriptTask_8" isExpanded="true">
        <dc:Bounds height="50.0" width="64.0" x="212.0" y="403.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_9">
          <dc:Bounds height="11.0" width="33.0" x="227.0" y="422.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ScriptTask_9" bpmnElement="ScriptTask_9" isExpanded="true">
        <dc:Bounds height="50.0" width="73.0" x="255.0" y="489.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_10">
          <dc:Bounds height="11.0" width="50.0" x="266.0" y="508.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ExclusiveGateway_4" bpmnElement="ExclusiveGateway_4" isMarkerVisible="true">
        <dc:Bounds height="50.0" width="50.0" x="43.0" y="403.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_11"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_StartEvent_1" bpmnElement="StartEvent_2">
        <dc:Bounds height="36.0" width="36.0" x="582.0" y="492.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_13">
          <dc:Bounds height="11.0" width="52.0" x="574.0" y="528.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_CallActivity_1" bpmnElement="CallActivity_1" isExpanded="true">
        <dc:Bounds height="50.0" width="110.0" x="662.0" y="485.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_14">
          <dc:Bounds height="11.0" width="34.0" x="700.0" y="504.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ScriptTask_10" bpmnElement="ScriptTask_10" isExpanded="true">
        <dc:Bounds height="50.0" width="70.0" x="823.0" y="485.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_15">
          <dc:Bounds height="11.0" width="59.0" x="828.0" y="504.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_Task_2" bpmnElement="Task_2" isExpanded="true">
        <dc:Bounds height="50.0" width="79.0" x="935.0" y="485.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_16">
          <dc:Bounds height="11.0" width="49.0" x="950.0" y="504.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_EndEvent_2" bpmnElement="EndEvent_3">
        <dc:Bounds height="36.0" width="36.0" x="1072.0" y="492.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_17">
          <dc:Bounds height="22.0" width="75.0" x="1053.0" y="528.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_Task_4" bpmnElement="Task_4" isExpanded="true">
        <dc:Bounds height="50.0" width="110.0" x="475.0" y="185.0"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="11.0" width="47.0" x="506.0" y="204.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_2" bpmnElement="SequenceFlow_2" sourceElement="BPMNShape_1" targetElement="BPMNShape_ScriptTask_1">
        <di:waypoint xsi:type="dc:Point" x="136.0" y="118.0"/>
        <di:waypoint xsi:type="dc:Point" x="190.0" y="118.0"/>
        <di:waypoint xsi:type="dc:Point" x="190.0" y="120.0"/>
        <di:waypoint xsi:type="dc:Point" x="245.0" y="120.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_18"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_3" bpmnElement="SequenceFlow_3" sourceElement="BPMNShape_ScriptTask_1" targetElement="BPMNShape_ScriptTask_2">
        <di:waypoint xsi:type="dc:Point" x="355.0" y="120.0"/>
        <di:waypoint xsi:type="dc:Point" x="397.0" y="120.0"/>
        <di:waypoint xsi:type="dc:Point" x="440.0" y="120.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_19"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_8" bpmnElement="SequenceFlow_6" sourceElement="BPMNShape_ExclusiveGateway_3" targetElement="BPMNShape_IntermediateCatchEvent_1">
        <di:waypoint xsi:type="dc:Point" x="396.0" y="261.0"/>
        <di:waypoint xsi:type="dc:Point" x="396.0" y="335.0"/>
        <di:waypoint xsi:type="dc:Point" x="396.0" y="410.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_20">
          <dc:Bounds height="11.0" width="42.0" x="376.0" y="337.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_9" bpmnElement="SequenceFlow_7" sourceElement="BPMNShape_IntermediateCatchEvent_1" targetElement="BPMNShape_ScriptTask_8">
        <di:waypoint xsi:type="dc:Point" x="378.0" y="428.0"/>
        <di:waypoint xsi:type="dc:Point" x="327.0" y="428.0"/>
        <di:waypoint xsi:type="dc:Point" x="276.0" y="428.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_21"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_10" bpmnElement="SequenceFlow_8" sourceElement="BPMNShape_ScriptTask_7" targetElement="BPMNShape_ScriptTask_9">
        <di:waypoint xsi:type="dc:Point" x="207.0" y="514.0"/>
        <di:waypoint xsi:type="dc:Point" x="231.0" y="514.0"/>
        <di:waypoint xsi:type="dc:Point" x="255.0" y="514.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_22"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_11" bpmnElement="SequenceFlow_9" sourceElement="BPMNShape_ScriptTask_9" targetElement="BPMNShape_2">
        <di:waypoint xsi:type="dc:Point" x="328.0" y="514.0"/>
        <di:waypoint xsi:type="dc:Point" x="349.0" y="514.0"/>
        <di:waypoint xsi:type="dc:Point" x="370.0" y="514.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_23"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_14" bpmnElement="SequenceFlow_12" sourceElement="BPMNShape_ScriptTask_8" targetElement="BPMNShape_ExclusiveGateway_4">
        <di:waypoint xsi:type="dc:Point" x="212.0" y="428.0"/>
        <di:waypoint xsi:type="dc:Point" x="153.0" y="428.0"/>
        <di:waypoint xsi:type="dc:Point" x="93.0" y="428.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_24"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_15" bpmnElement="SequenceFlow_13" sourceElement="BPMNShape_ExclusiveGateway_4" targetElement="BPMNShape_ScriptTask_7">
        <di:waypoint xsi:type="dc:Point" x="68.0" y="453.0"/>
        <di:waypoint xsi:type="dc:Point" x="68.0" y="514.0"/>
        <di:waypoint xsi:type="dc:Point" x="97.0" y="514.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_25"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_16" bpmnElement="SequenceFlow_14" sourceElement="BPMNShape_ExclusiveGateway_3" targetElement="BPMNShape_ExclusiveGateway_4">
        <di:waypoint xsi:type="dc:Point" x="371.0" y="236.0"/>
        <di:waypoint xsi:type="dc:Point" x="68.0" y="236.0"/>
        <di:waypoint xsi:type="dc:Point" x="68.0" y="403.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_26">
          <dc:Bounds height="11.0" width="39.0" x="117.0" y="237.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_19" bpmnElement="SequenceFlow_17" sourceElement="BPMNShape_CallActivity_1" targetElement="BPMNShape_ScriptTask_10">
        <di:waypoint xsi:type="dc:Point" x="772.0" y="510.0"/>
        <di:waypoint xsi:type="dc:Point" x="797.0" y="510.0"/>
        <di:waypoint xsi:type="dc:Point" x="823.0" y="510.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_29"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_20" bpmnElement="SequenceFlow_18" sourceElement="BPMNShape_StartEvent_1" targetElement="BPMNShape_CallActivity_1">
        <di:waypoint xsi:type="dc:Point" x="618.0" y="510.0"/>
        <di:waypoint xsi:type="dc:Point" x="640.0" y="510.0"/>
        <di:waypoint xsi:type="dc:Point" x="662.0" y="510.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_30"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_21" bpmnElement="SequenceFlow_19" sourceElement="BPMNShape_ScriptTask_10" targetElement="BPMNShape_Task_2">
        <di:waypoint xsi:type="dc:Point" x="893.0" y="510.0"/>
        <di:waypoint xsi:type="dc:Point" x="914.0" y="510.0"/>
        <di:waypoint xsi:type="dc:Point" x="935.0" y="510.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_31"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_22" bpmnElement="SequenceFlow_20" sourceElement="BPMNShape_Task_2" targetElement="BPMNShape_EndEvent_2">
        <di:waypoint xsi:type="dc:Point" x="1014.0" y="510.0"/>
        <di:waypoint xsi:type="dc:Point" x="1043.0" y="510.0"/>
        <di:waypoint xsi:type="dc:Point" x="1072.0" y="510.0"/>
        <bpmndi:BPMNLabel id="BPMNLabel_32"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_5" bpmnElement="SequenceFlow_5" sourceElement="BPMNShape_ScriptTask_2" targetElement="BPMNShape_Task_4">
        <di:waypoint xsi:type="dc:Point" x="495.0" y="145.0"/>
        <di:waypoint xsi:type="dc:Point" x="495.0" y="165.0"/>
        <di:waypoint xsi:type="dc:Point" x="530.0" y="165.0"/>
        <di:waypoint xsi:type="dc:Point" x="530.0" y="185.0"/>
        <bpmndi:BPMNLabel/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_6" bpmnElement="SequenceFlow_10" sourceElement="BPMNShape_Task_4" targetElement="BPMNShape_ExclusiveGateway_3">
        <di:waypoint xsi:type="dc:Point" x="475.0" y="210.0"/>
        <di:waypoint xsi:type="dc:Point" x="396.0" y="210.0"/>
        <di:waypoint xsi:type="dc:Point" x="396.0" y="211.0"/>
        <bpmndi:BPMNLabel/>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn2:definitions>